# 要件定義書：ドメイン特化型 RAG Q&A Webサービス

## 1. サービス概要

管理者がテキストソースを登録することで特定分野に特化したAIを作成し、
一般ユーザーがURLにアクセスするだけで質問→回答を得られるWebサービス。

---

## 2. ユーザー定義

| ロール | 説明 | 認証 |
|--------|------|------|
| 管理者 | ソースを登録してAIを育てる人 | ログイン必須（パスワード認証） |
| ユーザー | AIに質問する一般利用者 | 不要（URL直アクセス） |

---

## 3. 機能要件

### 管理者向け

| 機能 | 詳細 |
|------|------|
| ログイン | パスワードで管理画面にログイン / ログアウト |
| ソース登録 | タイトル＋テキスト本文を貼り付けて登録 |
| ソース一覧 | 登録済みソースの一覧表示（タイトル・登録日） |
| ソース削除 | 登録済みソースを削除（AIの知識からも除去） |

### ユーザー向け

| 機能 | 詳細 |
|------|------|
| Q&A | 質問を入力して送信すると、AIが回答を返す |
| 単発形式 | 毎回独立したQ&A（会話履歴なし） |
| スコープ外制御 | ソース外の質問には「提供された情報の範囲外のため、お答えできません。」と返す |
| ソース引用なし | 回答文のみ表示（どのソースから引用したかは非表示） |

---

## 4. 対象外（MVP）

- 複数分野の切り替え（1分野のみ）
- ファイルアップロード（テキスト入力のみ）
- ユーザー認証・利用制限
- 会話形式チャット
- 回答のストリーミング表示
- ソースの編集（削除して再登録で代替）

---

## 5. 画面構成

```
/                   ← ユーザー向けQ&A画面（誰でもアクセス可）
/admin/login        ← 管理者ログイン
/admin/sources      ← ソース管理（一覧・登録・削除）
```

### Q&A画面

```
┌──────────────────────────────────────┐
│  [サービス名 / 分野名]                 │
│                                      │
│  ┌────────────────────────────────┐  │
│  │ 質問を入力してください...        │  │
│  └────────────────────────────────┘  │
│                       [質問する]      │
│                                      │
│  ─────────────────────────────────  │
│                                      │
│  [AIの回答がここに表示される]          │
│                                      │
└──────────────────────────────────────┘
```

### 管理画面

```
┌──────────────────────────────────────┐
│  ソース管理                  [ログアウト]│
│                                      │
│  新しいソースを追加                    │
│  タイトル: [______________]           │
│  テキスト: [                ]         │
│            [                ]         │
│                       [登録する]      │
│                                      │
│  登録済みソース一覧                    │
│  ┌─────────────────────────────────┐ │
│  │ タイトルA  2025-01-01   [削除]   │ │
│  │ タイトルB  2025-01-02   [削除]   │ │
│  └─────────────────────────────────┘ │
└──────────────────────────────────────┘
```

---

## 6. 非機能要件

| 項目 | 要件 |
|------|------|
| 回答速度 | 送信から10秒以内に回答表示 |
| セキュリティ | 管理画面はログインなしでアクセス不可 |
| 対応ブラウザ | Chrome最新版（MVP） |

---

## 7. 技術スタック

| 役割 | 採用技術 |
|------|----------|
| フロントエンド | Next.js 16 (App Router) + TypeScript + Tailwind CSS |
| バックエンド | Next.js API Routes（同一プロジェクト） |
| LLM（回答生成） | Claude API (claude-sonnet-4-6) |
| Embedding | OpenAI text-embedding-3-small |
| データベース | Supabase PostgreSQL |
| ベクターDB | Supabase pgvector |
| 管理者認証 | JWTクッキー（joseライブラリ） |
| デプロイ | Vercel |

---

## 8. システム処理フロー

### ソース登録時

```
管理者がテキストを入力
  → テキストを約500文字ずつに分割（チャンキング）
  → 各チャンクをOpenAI Embeddingでベクター化
  → Supabase pgvectorに保存
  → 完了
```

### 質問時

```
ユーザーが質問を入力
  → 質問をOpenAI Embeddingでベクター化
  → pgvectorで類似チャンクを検索（上位5件）
  → 質問 + 関連チャンク をClaudeに送信
  → Claudeが回答を生成
  → ユーザーに回答を表示
```

---

## 9. 必要な外部サービス・APIキー

| サービス | 用途 | 備考 |
|----------|------|------|
| Anthropic API | 回答生成（Claude） | console.anthropic.com |
| OpenAI API | Embedding生成のみ | platform.openai.com |
| Supabase | DB + ベクターDB | supabase.com（無料枠あり） |
| Vercel | ホスティング | vercel.com（無料枠あり） |
